document.title="欢迎使用“社会主义核心价值观”游戏——夸父追日";function setPerson(obj){obj.style.top=obj.r*84-5+"px";obj.style.left=obj.c*84+14+"px"}function loadImgs(arr,fn){var json={};var loaded=0;for(var i=0;i<arr.length;i++){var oImg=new Image();oImg.src=arr[i];var name=arr[i].split(".")[0];oImg.onload=function(){loaded++;if(loaded==arr.length){fn()}};json[name]=oImg}return json}var LoadingList=["begin_bg.jpg","games_bg.jpg","games_bg.png","person_03.png","share.jpg","st.png","tips.jpg"];window.onload=function(){var oTipsBtn=document.querySelector("#tips_btn");var oBeginWeb=document.querySelector("#bg_web");var oTipsWeb=document.querySelector("#tip_web");var oTips=document.querySelector("#tips");var oReturn=document.querySelector("#return");var oBeginBtn=document.querySelector("#start");var oGame=document.querySelector("#game_web");var oLoading=document.querySelector("#loading_web");var oShare=document.querySelector("#share");var aWords=[["我为","核心","价值","代言"],["富强","民主","文明","和谐"],["自由","平等","公正","法治"],["爱国","敬业","诚信","友善"]];var oC=document.querySelector("#game_box");var oFont=document.querySelector(".score");var oTime=document.querySelector(".time");var oReStart=document.querySelector("#restart");var oApply=document.querySelector("#reply");var oBeginImg=document.querySelector("#begin_img");var token=a.getAttribute("data");var foot=0;var aDot=[];var aLight=[];var time=0;if($(window).width()>=780){document.body.innerHTML="";alert("请使用微信浏览器打开")}if($(window).height()<=470){oBeginImg.style.width=$(window).width()+"px";oBeginImg.style.height=$(window).height()+"px";oBeginWeb.style.width=$(window).width()+"px";oBeginWeb.style.height=$(window).height()+"px";oGame.style.width=$(window).width()+"px";oGame.style.height=$(window).height()+"px";oTipsWeb.style.width=$(window).width()+"px";oTipsWeb.style.height=$(window).height()+"px";oTips.style.width=$(window).width()+"px";oTips.style.height=$(window).height()+"px";oShare.style.width=$(window).width()+"px";oShare.style.height=$(window).height()+"px";share_img.style.height=$(window).height()+"px";share_img.style.width=$(window).width()+"px"}loadImgs(LoadingList,function(){oLoading.style.display="none";oBeginWeb.style.display="block"});oBeginBtn.addEventListener("click",function(){oBeginWeb.style.display="none";oGame.style.display="block";oTime.innerHTML="时间："+time+"";timer=setInterval(function(){time++;oTime.innerHTML="时间："+time+""},1000)});for(var i=0;i<4;i++){for(var j=0;j<4;j++){oNewDiv=document.createElement("div");oNewDiv.className="dot";oC.appendChild(oNewDiv);aDot[i*4+j]={c:j,r:i,div:oNewDiv,type:"dark",inner:aWords[i][j]}}}for(var i=0;i<aDot.length;i++){aDot[i].div.style.top=aDot[i].r*84+28+"px";aDot[i].div.style.left=aDot[i].c*84+13+"px";aDot[i].div.innerHTML=aDot[i].inner}for(var i=0;i<3;i++){var r=parseInt(4*Math.random());var c=parseInt(4*Math.random());for(var j=0;j<aDot.length;j++){if(aDot[j].c==c&&aDot[j].r==r&&aDot[j].type=="dark"){aDot[j].div.style.background="red";aDot[j].div.style.color="yellow";aDot[j].type="light";aLight.push({r:r,c:c})}}}oPerson=document.createElement("div");oPerson.className="person";oPerson.r=parseInt(4*Math.random());oPerson.c=parseInt(4*Math.random());oC.appendChild(oPerson);setPerson(oPerson);for(var i=0;i<aDot.length;i++){aDot[i].div.index=i;aDot[i].div.addEventListener("click",function(){var found=false;if(Math.abs(aDot[this.index].c-oPerson.c)==2&&Math.abs(aDot[this.index].r-oPerson.r)==1){found=true}if(Math.abs(aDot[this.index].c-oPerson.c)==1&&Math.abs(aDot[this.index].r-oPerson.r)==2){found=true}if(found){foot++;oFont.innerHTML="步数："+foot+"";if(aDot[this.index].type=="light"){aDot[this.index].type="dark";aDot[this.index].div.style.background="#3b2a01";aDot[this.index].div.style.color="#fff"}else{aDot[this.index].type="light";this.style.background="red";this.style.color="yellow"}oPerson.c=aDot[this.index].c;oPerson.r=aDot[this.index].r;setPerson(oPerson)}var end=0;for(var i=0;i<aDot.length;i++){if(aDot[i].type=="light"){end++}}if(end==16){alert("您一共走了"+foot+"步！！！");oGame.style.display="none";oShare.style.display="block";clearInterval(timer);document.title="我在夸父追日中在"+time+"秒内以"+foot+"步取得了胜利"}},false)}oApply.addEventListener("click",function(){var phone=phone_input.value;if(phone.length!=11){return}$.ajax({type:"POST",url:"/game/public/post",dataType:"json",contentType:"application/json",data:JSON.stringify({phone:phone,time:time,score:foot,type:"sun",_token:token}),beforeSend:function(){alert("已提交！")},success:function(response){if(response){var data=$.parseJSON(response);if(data.status==200){var rank=data.rank;document.title='我在"夸父追日"中在'+time+"秒内以"+foot+"步取得了胜利，排名第"+rank+"";alert("提交成功，点击右上角分享到朋友圈就可以看见你的排名哦")}else{alert("网络错误!")}}}})},false);oTipsBtn.addEventListener("click",function(){oBeginWeb.style.display="none";oTipsWeb.style.display="block"},false);oReturn.addEventListener("click",function(){oTipsWeb.style.display="none";oBeginWeb.style.display="block"},false);oReStart.addEventListener("click",function(){self.location.reload()},false);
    reload.addEventListener("click",function(){self.location.reload()})};